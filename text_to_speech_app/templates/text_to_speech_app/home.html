{% extends "text_to_speech_app/baselayout.html" %}

{% block content %}
    <div class="container">
        
        <div class="row">
            <div class="col-md-6">
                <div class="card shadow p-3 mt-3 text-center">
                    <form action="" method="post" novalidate>
                        {% csrf_token %}
                        {% for field in form %}
                            {{field.label_tag}} <br><span class="errors">{{field.errors|striptags}}</span>
                            {{field}} <br>
                        {% endfor %}
                        <input type="submit" value="Get speech" id="getspeech" class="btn form-control btn-dark">
                    </form>
                </div>
            </div>
            <div class="col-md-6">
                
                <div class="card shadow p-3 mt-3 ">
                    <p class="text-center fw-bold">Your speech in accent </p>
                    {% if messages %}           
                        {% for message in messages %}
                            <div class="text-center alert alert-primary alert-{{message.tags}} alert-dismissible fade show" role="alert">
                                {{message}}
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>
                        {% endfor %}             
                    {% endif %}
                    <div class="text-center mt-5">
                        <audio controls>
                            <source id="audioid" src="" type="audio/mpeg">
                        </audio>
                    </div>
                </div>
            </div>
        </div>
        <div id="myid">

        </div>
        
    </div>
    
{% endblock content %}


{% block custom_js %}

    <script>
        document.querySelector("#getspeech").addEventListener("click",function(){
            var tld=document.querySelector("#id_tld").value
            var text=document.querySelector("#id_text").value
            var data={
                "tld":tld,
                "text":text
            }
            console.log(data)
            var accent = document.getElementById("id_tld")
            accent_value=accent.value
            fetch('{% url "get_speech" %}',{
                method:"POST",
                body:JSON.stringify(data),
                headers: {'Content-Type': 'application/json'}
            })
            .then(function(response){
                return response.blob()
                
            })
            .then(function(blob){
                const audioUrl = URL.createObjectURL(blob);
                const audio = new Audio(audioUrl);
                audio.play();
                accent.value=data["tld"]
            })
            .catch(error => {
                console.error('Fetch error:', error);
              });
        })
    </script>

{% endblock custom_js %}




